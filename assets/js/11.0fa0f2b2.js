(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{215:function(e,r,n){"use strict";n.r(r);var t=n(0),s=Object(t.a)({},(function(){var e=this,r=e.$createElement,n=e._self._c||r;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"简单的用node爬去网页上的内容："}},[n("a",{staticClass:"header-anchor",attrs:{href:"#简单的用node爬去网页上的内容："}},[e._v("#")]),e._v(" 简单的用node爬去网页上的内容：")]),e._v(" "),n("h4",{attrs:{id:"_1-安装express以及生成器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装express以及生成器"}},[e._v("#")]),e._v(" 1.安装express以及生成器")]),e._v(" "),n("p",[e._v("express官网："),n("a",{attrs:{href:"http://www.expressjs.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://www.expressjs.com.cn/"),n("OutboundLink")],1)]),e._v(" "),n("pre",[n("code",[e._v("  npm install express --save\n\n  npm install express-generator -g\n")])]),e._v(" "),n("h4",{attrs:{id:"_2-用生成器创建新express应用-进入项目并安装依赖包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-用生成器创建新express应用-进入项目并安装依赖包"}},[e._v("#")]),e._v(" 2.用生成器创建新Express应用,进入项目并安装依赖包")]),e._v(" "),n("pre",[n("code",[e._v("  express myapp\n\n  cd myapp\n\n  npm install\n")])]),e._v(" "),n("h4",{attrs:{id:"_3-安装superagent"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装superagent"}},[e._v("#")]),e._v(" 3.安装superagent")]),e._v(" "),n("p",[e._v("superagent官网："),n("a",{attrs:{href:"http://visionmedia.github.io/superagent/",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://visionmedia.github.io/superagent/"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("code",[e._v("npm install superagent")])]),e._v(" "),n("h4",{attrs:{id:"_4-安装cheerio"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装cheerio"}},[e._v("#")]),e._v(" 4.安装cheerio")]),e._v(" "),n("p",[e._v("cheerio官网："),n("a",{attrs:{href:"https://cheerio.js.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cheerio.js.org/"),n("OutboundLink")],1)]),e._v(" "),n("p",[n("code",[e._v("npm install cheerio")])]),e._v(" "),n("h4",{attrs:{id:"_5-在routes文件夹下新建路由文件news-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-在routes文件夹下新建路由文件news-js"}},[e._v("#")]),e._v(" 5.在routes文件夹下新建路由文件news.js")]),e._v(" "),n("pre",[n("code",[e._v("var express = require(\"express\");\nconst cheerio = require('cheerio');\nconst superagent = require('superagent');\nvar router = express.Router();\n\nrouter.get('/', function (req, res, next) {\n  // 抓取内容\n  superagent.get('http://www.donews.com/')\n    .end(function (err, sres) {\n      if (err) {\n        return next(err);\n      }\n      var $ = cheerio.load(sres.text);\n      var items = [];\n      $('div.block h3.block a').each(function (idx, element) {\n        var $element = $(element);\n        items.push({\n          title: $element.text(),\n          href: $element.attr('href')\n        });\n      });\n      res.send(items);\n    });\n});\n\nmodule.exports = router;\n")])]),e._v(" "),n("blockquote",[n("p",[e._v("superagent.get('抓取网页的地址')")]),e._v(" "),n("p",[e._v("网页的 html 内容存储在 "),n("strong",[e._v("sres.text")]),e._v(" 里面")]),e._v(" "),n("p",[e._v("用 "),n("strong",[e._v("cheerio.load")]),e._v(" 加载得到的html内容并赋给变量 "),n("strong",[e._v("$")])]),e._v(" "),n("p",[e._v("后面选择需要的内容部分语法和jQuery选择器基本一致，选择需要的元素进行遍历")]),e._v(" "),n("p",[e._v("然后返回遍历的内容")])]),e._v(" "),n("h4",{attrs:{id:"_6-在app-js中引入路由文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-在app-js中引入路由文件"}},[e._v("#")]),e._v(" 6.在app.js中引入路由文件")]),e._v(" "),n("pre",[n("code",[e._v("var createError = require('http-errors');\nvar express = require('express');\nvar path = require('path');\nvar cookieParser = require('cookie-parser');\nvar logger = require('morgan');\n\nvar newsRouter = require('./routes/news');\n\nvar app = express();// 创建实例\n\nvar myLogger = function (req, res, next) {\n  console.log('LOGGED');\n  next();\n}\n\nvar requestTime = function (req, res, next) {\n  req.requestTime = Date.now();\n  console.log(req.requestTime);\n  next();\n}\n\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'pug');\n\napp.use(logger('dev'));\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(express.static(path.join(__dirname, 'public')));// 将 public 目录下的图片、CSS 文件、JavaScript 文件对外开放访问(此写法为绝对路径)\n\napp.use(myLogger);\napp.use(requestTime);\n\napp.use('/news', newsRouter);\n\n\n//设置跨域请求\napp.use('*', function (req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header('Access-Control-Allow-Headers', 'Content-Type, Content-Length, Authorization, Accept, X-Requested-With , yourHeaderFeild');\n  res.header(\"Access-Control-Allow-Methods\", \"PUT,POST,GET,DELETE,OPTIONS\");\n  res.header(\"X-Powered-By\", ' 3.2.1')\n  res.header(\"Content-Type\", \"application/json;charset=utf-8\");\n  next();\n});\n\n// catch 404 and forward to error handler\napp.use(function(req, res, next) {\n  next(createError(404));\n});\n\n// error handler\napp.use(function(err, req, res, next) {\n  // set locals, only providing error in development\n  res.locals.message = err.message;\n  res.locals.error = req.app.get('env') === 'development' ? err : {};\n\n  // render the error page\n  res.status(err.status || 500);\n  res.render('error');\n});\n\nmodule.exports = app;\n")])]),e._v(" "),n("blockquote",[n("p",[e._v("引入路由的代码：")]),e._v(" "),n("p",[n("strong",[e._v("var newsRouter = require('./routes/news');")])]),e._v(" "),n("p",[n("strong",[e._v("app.use('/news', newsRouter);")])])]),e._v(" "),n("h4",{attrs:{id:"_7-运行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-运行"}},[e._v("#")]),e._v(" 7.运行")]),e._v(" "),n("p",[n("code",[e._v("npm start")])]),e._v(" "),n("p",[e._v("浏览器打开 http://loaclhost:3000/news 即可看见返回的数据")])])}),[],!1,null,null,null);r.default=s.exports}}]);